let Log = require("@dp/log");
let router = require("../../util/router");
let Shell = require("../../util/shell");
const STATUS = require("../../util/status");
const CLIENT_ROUTER_PATH = require("../../client/path");

module.exports = function(client,data){
	let module = data.module;
	if(!module){
		client.write(router.send(CLIENT_ROUTER_PATH.OTHER,`module不能为空`));
		return ;
	}
	// 下载模块
	Shell(`npm install ${module.name}${module.version ? "@"+module.version : ""} -g`,(status,data)=>{
		// 信息输出
		if(status == STATUS.DATA_INFO){
			Log.info(data);
			client.write(router.send(CLIENT_ROUTER_PATH.INFO,data));
		// 成功处理
		}else if(status == STATUS.DATA_SUCCESS){
		    Log.success(`下载${JSON.stringify(module)}成功`);
			client.write(router.send(CLIENT_ROUTER_PATH.CLOSE,data));
		// 错误处理
		}else{
		    Log.info("server_error:"+data);
			client.write(router.send(CLIENT_ROUTER_PATH.OTHER,data));
		}
	});
}