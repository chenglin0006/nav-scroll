## lion-client

Java `lion-client` 的Node版本，依赖`Zookeeper` ，请确保你的本地有 `/data/webapps/appenv`文件

```bash
deployenv=qa

zkserver=qa.lion.dp:2181
```

# Install

```javascript 

npm install @dp/lion-client --save

```

# Usage

Web应用使用方法非常简单 , 通过 `getProperty`方法获取值， 返回的是一个 [Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)

```javascript 

var Lion = require("@dp/lion-client");

var value = yield Lion.getProperty("someLionKey" , "default");

//或者
Lion.getProperty("someLionKey","default").then(function(value){
    console.log(value);
});

```

NOTE : 如果你的应用不是Web应用,如命令行工具等,请使用 `Lion.httpGetProperty` 接口

# API

## init()

初始化lion ， 根据环境初始化Zookeeper的连接等， 推荐在web应用启动阶段调用 ，返回一个[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)
不初始化也没关系，getProperty在第一次调用时会默认调用此方法

```javascript

//in web app start function
try{
    yield Lion.init();
}catch(e){
    console.error(e);
}

```


## getProperty(key,defaultValue)

获取配置的值

- key : Lion上配置的key
- defaultValue : 读取不到key时的默认值 , 默认为`null`
- 返回[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) , resolve 的值是 `String` 

！！注意 ，请不要再任意地方缓存Lion获取到的值,这会导致在配置后台修改值后无法更新， 永远在你用的时候调用此API获取值

```javascript

//在generator中
var value = yield Lion.getProperty(key,defaultValue);

//不在generator中
Lion.getProperty(key,defaultValue).then(function(value){
    //value here
});


```

## httpGetProperty(key,env,defaultValue)

通过http的方式获取配置值 , 非web应用请使用此接口 . 用法和getProperty API基本一致 ,除了需要指定env和不缓存结果
NOTE:此接口查询线上值时对机器IP有白名单控制


- key : 同getProperty API的key
- env : 指定环境, 可选值 'dev', 'alpha', 'qa','beta', 'ppe','prelease', 'product', 'performance' ,其中qa和beta等价,ppe和prelease等价
- defaultValue : 同 getProperty API的defaultValue
 

```javascript

//在generator中
var value = yield Lion.httpGetProperty(key,env,defaultValue);

//不在generator中
Lion.httpGetProperty(key,env,defaultValue).then(function(value){
    //value here
});


```

## addListener(key,listener)

为Lion key增加监听函数 , 每次修改的时候会触发执行监听函数

- key , String  Lion key
- listener , Function , 会传入一个最新的Lion值作为参数


## Change Log

### v1.3.0 
    
    支持泳道配置, 优先读取配置的泳道值, 如果失败, 降级到正常值.
