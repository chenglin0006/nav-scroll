let spawn = require('child_process').spawn;
let STATUS = require('./status');
let Log = require("@dp/log");

module.exports = function (command, cb) {

    let args = command.split(/\s+/);

    let main = args.shift();
    let child = spawn(main, args);
    let result;
    child.stdout.setEncoding('utf8');
    child.stderr.setEncoding('utf8');


    child.stdout.on('data', (data)=> {
          cb(STATUS.DATA_INFO,data);
    });

    child.stderr.on('data', (data)=> {
        cb(STATUS.DATA_INFO,data);
    });

  child.on('close', (code)=> {
      if (code) {
        cb(STATUS.DATA_ERROR,'child process exited with code ' + code);
      }else{
          cb(STATUS.DATA_SUCCESS);
      }
  });
}