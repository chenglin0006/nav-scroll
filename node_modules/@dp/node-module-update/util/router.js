let Log = require("@dp/log");
const STATUS = require("./status");
const CT = require("./ct");

function send(path,info){
	if(!path && typeof path == "string")	
		Log.error(`非法路径:${path}`);

	return JSON.stringify({
		path:path,
		data:info
	})+CT.HANDLER_SEQ
}

function accept(info){
	let data = info.toString();
	return data.split(CT.HANDLER_SEQ).filter((it)=>{
		return it;
	}).map((it)=>{
		let command = typeof it == "string" ? JSON.parse(it) : it;
		if(!command.path && typeof command.path == "string")
			return {
				path:STATUS.OTHER,
				code:STATUS.SUCCESS
			}
		return Object.assign(command,{
			code:STATUS.SUCCESS
		});
	}) || [];
}

module.exports = {
	send:send,
	accept:accept
}