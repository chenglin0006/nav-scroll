//腾讯X5浏览器定位，适合在android 微信和手Q环境下使用
var util = require("../util");
var config = require('../config');

var useTecentGeo = function() {
  // return ~config.get('enables').indexOf('x5');
  return false;
};

module.exports = function(suc, fail, next) {
  if (!useTecentGeo()) {
    next();
  } else {

    var done = false;

    var geoIframeId = '_geoIframe_' + Math.ceil(Math.random() * 10000000);
    var geoIframe = document.createElement('iframe');
    var key = '6ULBZ-4X3C3-QEK3S-3ZRI6-6D7RE-WQFRQ';
    var referer = '大众点评M站';
    var src = location.protocol + '//apis.map.qq.com/tools/geolocation?key=' + key + '&referer=' + referer + '_js';
    if (config.get('debug')) {
      src +' &debug=1';
    }
    geoIframe.setAttribute('id', geoIframeId);
    geoIframe.setAttribute('src', src);
    geoIframe.setAttribute('style', 'display: none; width: 100%; height: 30%');
    document.body.appendChild(geoIframe);

    window.addEventListener('message', function(event) {
      // 接收位置信息
      var position = event.data;
      if (!done) {
        if (position) {
          suc({
            geoType: 'gcj02',
            lat: position.lat,
            lng: position.lng
          })
        } else {
          next();
        }
      }
    }, false);
  }

};


module.exports.type = "x5";
