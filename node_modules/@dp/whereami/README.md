
# WhereAmI

顾名思义， 定位模块， 使用简单， 童叟无欺。

## Features

1. *多平台适配*:

- url参数截取
    
- cookie，localStorage缓存
    
- QQ浏览器定位API

- 手机QQ 定位API
    
- 微信JSSDK定位API
    
- 点评主App JSBridge定位

- 美团团App URL注入定位
    
- HTML5 geolocation定位API
    
1. *易用可配置*

1. *内置经纬度转换城市信息*

1. *[Cat监控](http://cat.dianpingoa.com/cat/r/web?op=piechart&query1=2015-07-23;129;;1;;00:00;12:25&groupByField=code&api1=whereami-type-all|whereami-type-all)*

## Usage

**npm**

- 安装 `npm install @dp/whereami --save`

使用了require.ensure用法，**webpack打包可使用**

**cortex**

- 安装 `cortex install whereami --save`

### 务必看下`wxAutoConfig`的config说明！！！！！！

- 调用

    ```javascript
    //npm引用
    //var WhereAmI = require("@dp/whereami");
    
    var WhereAmI = require("whereami");
    
    WhereAmI(function(res){
        //成功回调, res.lat, res.lng 获取经纬度
        console.log(res);
    },function(){
        //失败回调
    });
    
    
    ```
    
## API


#### WhereAmI.config(obj); 参数配置

  ```javascript
  //example
  
  WhereAmI.config({
    timeout: 10000,
    enables: [], 
    disables: [],
    urlParamNames: ["latitude", "longitude"],
    cacheType: "cookie", 
    cookieNames: ["locallat", "locallng"],
    storageName: "whereami",
    wxAutoConfig: false,
    city:false,
    cityType: 'dianping'  
    debug: false,
    sampling: 0.5
  });
  ```
  
  各配置参数说明：
  
  - `timeout` 超时时间, 默认值`10000`ms

  - `enables` 默认不使用的定位方案，需要单独启用，启用后会自动做环境判断确定是否真正使用，数组，默认值`[]`,可选项为['x5']

  - `disables` 需要禁用的平台，数组,默认值`[]` ,可选项为["url","cache","qqbrowser","weixin","mobileqq","app","html"]
  
  
  - `urlParamNames` url参数名,默认值`["latitude", "longitude"]`
  
  
  - `cacheType` 缓存类型，默认值`cookie`, 方便服务端读取到，可选`storage`
  
  
  - `cookieNames`,默认值`["locallat", "locallng"]` ,cacheType为cookie时生效
  
  
  - `storageName`,默认值`whereami` , cacheType为storage时生效
  
  
  - `wxAutoConfig` 是否开启微信JSSDK自动配置，默认值`false`,考虑到页面可能会只用其他微信sdk，默认让页面自己配置，需要在API列表中添加`getLocation`.如果你的页面不需要其他微信SDK， 可以配置此参数`true`， 会自动加载微信配置
  
    
  - `city` ,是否需要定位城市信息，默认`false`，设置为`true`之后，success的callback数据中会多一个`city`对象

  - `cityType`, 获取点评或者美团服务下对应的城市Id，页面在`.meituan.com`域名下默认`meituan`，其他默认`dianping`
    
  - `sampling`, 定位上报的抽样率[0,1)，默认0.5

  - debug, 默认`false`，配置为`true`或者在页面url上加入参数`?debug:whereami` 可以打印出debug信息  

####  WhereAmi(suc,fail); 调用定位
    
    
  - `suc` Function,成功的回调函数, 会传入如下结果
  
  ```javascript
  {
      geoType: 'wgs84', 坐标系类型,可能是`gcj02`|`wgs84`
      lat:1231,
      lng:1231,
      //如果config city true，如果cityType为'meituan'，只返回cityid,cityname
      city:{
          cityid: 1
          cityname: "上海"
          citypinyin: "shanghai"
      }
  }
  ```
    
  - `fail` 失败的回调函数

#### CHANGELOG

0.3.0版本支持cityType获取美团下的城市Id
0.5.0版本支持城市信息的缓存
  