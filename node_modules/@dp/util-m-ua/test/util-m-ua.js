'use strict';

var getUA = require('../index');

// To know the usage of `assert`, see: http://nodejs.org/api/assert.html
var assert = require('assert');

var userAgent;
var ua;
var url = 'http://board.meishi.meituan.com/board/list?version_name=6.8&ci=10&utm_term=6.8&utm_content=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&utm_source=Alpha&utm_campaign=AgroupBgroupGhomepage_category1_1__a1__gfood__hrecommend__i0H0&utm_medium=iphone&uuid=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&msid=DF0AD867-197E-4EA6-ADD9-C513FD35F17B2016-06-08-11-53555&f=iphone&_sr=fooddiscovery';
var query = '?version_name=6.8&ci=10&utm_term=6.8&utm_content=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&utm_source=Alpha&utm_campaign=AgroupBgroupGhomepage_category1_1__a1__gfood__hrecommend__i0H0&utm_medium=iphone&uuid=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&msid=DF0AD867-197E-4EA6-ADD9-C513FD35F17B2016-06-08-11-53555&f=iphone&_sr=fooddiscovery';

describe("ua检测测试", function(){
  
  describe("移动端检测",function() {
    it("移动设备",function() {
      userAgent = 'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.76 Mobile Safari/537.36';
      ua = getUA(userAgent,url);
      assert.equal(true,ua.isMobile);
    });
    it("非移动设备",function() {
      userAgent = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.84 Safari/537.36';
      ua = getUA(userAgent,url);
      assert.equal(false,ua.isMobile);
    })
  });
  describe("点评主App Ios", function(){
    it("8.1.2版本以后", function(){
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 KNB/1.0.0 iOS/9.3.2 dp/com.dianping.dpscope/8.1.2';
      ua = getUA(userAgent, url);
      assert.equal('8.1.2', ua.version);
      assert.equal('ios',ua.os);
      assert.equal('9.3.2', ua.osVersion);
      assert.equal('dpapp', ua.type);
    });
    it("8.1.2版本之前", function(){
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 dp/com.dianping.dpscope/8.1.0';
      ua = getUA(userAgent, url);
      assert.equal('9.3',ua.osVersion);
      assert.equal('8.1.0', ua.version);
      assert.equal('dpapp', ua.type);
    });
    it("测试版", function(){
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 dp/com.dianping.dpscope.ba/8.1.0';
      ua = getUA(userAgent, url);
      assert.equal('8.1.0', ua.version);
      assert.equal('dpapp', ua.type);
    });
  });
  describe("点评主App Android", function(){
    it("8.1.2版本以后", function(){
      userAgent = 'Mozilla/5.0 (Linux; Android 5.0.1; Nexus 5 Build/LRX22C) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile Safari/537.36 KNB/1.0.0 android/7.0.1 dp/com.dianping.v1/8.1.2';
      ua = getUA(userAgent, url);
      assert.equal('7.0.1',ua.osVersion);
      assert.equal('8.1.2', ua.version);
      assert.equal('dpapp', ua.type);
    });
    it("8.1.2版本之前", function(){
      userAgent = 'Mozilla/5.0 (Linux; Android 5.0.1; Nexus 5 Build/LRX22C) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile Safari/537.36 dp/com.dianping.v1/8.1.0';
      ua = getUA(userAgent, url);
      assert.equal('8.1.0', ua.version);
      assert.equal('dpapp', ua.type);
    });
    it("厂商定制版", function(){
      userAgent = 'Mozilla/5.0 (Linux; Android 5.0.1; Nexus 5 Build/LRX22C) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile Safari/537.36 dp/com.dianping.v1/8.0.0 adapter/8.1.0';
      ua = getUA(userAgent, url);
      assert.equal('8.1.0', ua.version);
      assert.equal('dpapp', ua.type);
    });
  });

  describe("美团主App iOS", function(){
    it("美团7.6版本以及之后", function(){
      userAgent = 'Mozilla/5.0 (Linux; Android 5.1; 1501_M02 Build/LMY47D) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/39.0.0.0 Mobile Safari/537.36 TitansX/1.0.0 KNB/1.0.0 android/5.1 mt/com.sankuai.meituan/7.6 MTNB/1.1.0 KNB/1.1.0 Android/5.1 MeituanGroup/7.6.0'
      ua = getUA(userAgent, url);
      assert.equal('mtgroup', ua.type);
      assert.equal('7.6.0',ua.version);
    });
    it("美团7.0版本以及之后", function(){
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_2 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13F69 KNB/1.0.0 iOS/9.3.2 Meituangroup/7.0';
      ua = getUA(userAgent, url);
      assert.equal('mtgroup', ua.type);
      assert.equal('7.0',ua.version);
    });
    it("美团7.0版本之前", function(){
      userAgent = "Mozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 MTNB/1.0.0 (iOS; Meituan 970)";
      ua = getUA(userAgent, url,query);
      assert.equal('mtgroup', ua.type);
      assert.equal('6.8',ua.version);
    });
  });

  describe("美团主App Android", function(){
    it("7.0版本以及之后", function(){
      userAgent = 'Mozilla/5.0 (Linux; Android 5.0.1; Nexus 5 Build/LRX22C) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile Safari/537.36 KNB/1.0.0 android/5.0.1 MeituanGroup/7.0';
      ua = getUA(userAgent, url);
      assert.equal('7.0', ua.version);
      assert.equal('mtgroup', ua.type);
    });
  });

  describe("美团其他App", function(){
    it("默认为mt环境", function(){
      url = 'http://board.meishi.meituan.com/board/list?version_name=6.8&ci=10&utm_term=6.8&utm_content=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&utm_source=Alpha&utm_campaign=BgroupGhomepage_category1_1__a1__gfood__hrecommend__i0H0&utm_medium=iphone&uuid=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&msid=DF0AD867-197E-4EA6-ADD9-C513FD35F17B2016-06-08-11-53555&f=iphone&_sr=fooddiscovery';
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 MTNB/1.0.0';
      ua = getUA(userAgent, url, query);
      assert.equal('mt', ua.type);
    });
  });

  describe("微信webview", function(){
    it("微信-ios", function(){
      userAgent = "Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_2 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13F69 MicroMessenger/6.3.16 NetType/WIFI Language/zh_CN";
      ua = getUA(userAgent,'http://m.dianping.com');
      assert.equal('6.3.16', ua.version);
      assert.equal('weixin', ua.type);
    });
  });

  describe("手机QQ webview", function(){
    it("手机QQ-ios", function(){
      //手Q 6.5 iOS版本 
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_2 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13F69 QQ/6.5.0.443 V1_IPH_SQ_6.5.0_1_APP_A Pixel/1080 Core/UIWebView NetType/WIFI Mem/100'
      ua = getUA(userAgent,'http://m.dianping.com');
      assert.equal('6.5.0.443', ua.version);
      assert.equal('qq', ua.type);
    });
  });

  describe("点评M站", function(){
    it("线上地址", function(){
      //iphone 6 userAgent
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://m.dianping.com');
      assert.equal('dianping', ua.source);
      assert.equal('product', ua.env);
    });
    it("beta地址", function(){
      //iphone 6 userAgent
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://m.51ping.com');
      assert.equal('dianping', ua.source);
      assert.equal('beta', ua.env);
    });
  });

  describe("美团M站", function(){
    it("线上地址", function(){
      //iphone 6 userAgent
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://i.meituan.com');
      assert.equal('meituan', ua.source);
      assert.equal('product', ua.env);
    });
    it("线上H5地址", function(){
      //iphone 6 userAgent
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://h5.meituan.net');
      assert.equal('meituan', ua.source);
      assert.equal('product', ua.env);
    });
    it("线上H5地址2", function(){
      //iphone 6 userAgent
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://g.meituan.com');
      assert.equal('meituan', ua.source);
      assert.equal('product', ua.env);
    });
    it("beta地址", function(){
      //iphone 6 userAgent
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://test.i.meituan.net');
      assert.equal('meituan', ua.source);
      assert.equal('beta', ua.env);
    });
    it("betaH5地址1", function(){
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://test-g.meituan.com');
      assert.equal('meituan', ua.source);
      assert.equal('beta', ua.env);
    });
    it("betaH5地址2", function(){
      //iphone 6 userAgent
      userAgent = 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1'
      ua = getUA(userAgent,'http://test.h5.meituan.com');
      assert.equal('meituan', ua.source);
      assert.equal('beta', ua.env);
    });
  });

});


